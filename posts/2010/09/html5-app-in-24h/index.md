---
title: "HTML5 читалка для iPhone за сутки"
date: "2010-09-30"
humanDate: "30 Sep, 2010"
permalink: "2010/09/30/html5-app-in-24h/"
tags: 
  - "fun"
  - "web-standards"
  - "useful"
comments: 
  -  author: "Михаил"
     id: "18885"
     url: "http://designnotfound.ru/"
     date: "2010-09-30 16:52:59"
     humandate: "30 Sep, 2010"
     content: | 
       Классная штука. 
       
       И я правильно понимаю, что раз на Android-устройствах браузер на базе webKit, то всё описаное работает и для него (Local Storage) в первую очередь?
       
       Осталось только переписать руководство по добавлению закладок на экран (кнопки "+" здесь нет).

     email: "mikhail.baranov@gmail.com"

  -  author: "Александр"
     id: "18880"
     url: "http://odevayka.com.ua"
     date: "2010-09-30 16:05:25"
     humandate: "30 Sep, 2010"
     content: | 
       Айфон у тебя, скорее всего, не заглючил, а поставили новую прошивку, где работает защита. Ставь через Cydia приложение Appsync и все будет устанавливатся напрямую, без Appstore ;-)

     email: "silverok@ukr.net"

  -  author: "D. Sohin"
     id: "18881"
     url: ""
     date: "2010-09-30 16:12:01"
     humandate: "30 Sep, 2010"
     content: | 
       &gt; hhttp://developer.apple.com/...
       
       hh

     email: "d@sohin.de"

  -  author: "Twitter Trackbacks for cssing :: Архив :: HTML5 читалка для iPhone за сутки [org.ua] on Topsy.com"
     id: "18882"
     url: "http://topsy.com/cssing.org.ua/2010/09/30/html5-app-in-24h/?utm_source=pingback&utm_campaign=L2"
     date: "2010-09-30 16:12:28"
     humandate: "30 Sep, 2010"
     content: | 
       [...] cssing :: Архив :: HTML5 читалка для iPhone за сутки cssing.org.ua/2010/09/30/html5-app-in-24h/ &ndash; view page &ndash; cached Блог про CSS и все что с этим связано. Новые приемы и технологии и т д. Tweets about this link [...]

     email: ""

  -  author: "Егор"
     id: "18883"
     url: ""
     date: "2010-09-30 16:14:58"
     humandate: "30 Sep, 2010"
     content: | 
       Здорово.
       А как конвертировали иконки в SVG?

     email: "semper.cras@gmail.com"

  -  author: "akella"
     id: "18884"
     url: "http://cssing.org.ua"
     date: "2010-09-30 16:19:52"
     humandate: "30 Sep, 2010"
     content: | 
       Зависит от иконок, но конкретно эти изначально были отрисованы в illustrator и потому оттуда же их так и сохранили в SVG. А вообще векторные редакторы почти все это умеют.

     email: "akella.a@gmail.com"

  -  author: "akella"
     id: "18886"
     url: "http://cssing.org.ua"
     date: "2010-09-30 16:55:40"
     humandate: "30 Sep, 2010"
     content: | 
       Да, и даже в Опере скорее всего тоже будет работать.
       
       Руководство получается надо заменить на обычное добавление в букмарки (в Андроиде кажется нет аналога плюсика). Просто сохраняем адрес книги, и при втором заходе будет выдаваться закешированная версия. Что вобщем будет работать во всех браузерах поддерживающих Application Cache и Local Storage, то есть и на андроиде. Вот только в опере надо попробовать потестировать.

     email: "akella.a@gmail.com"

  -  author: "mee"
     id: "18887"
     url: ""
     date: "2010-09-30 16:57:01"
     humandate: "30 Sep, 2010"
     content: | 
       К сожалению в Андроиде иконок тоже нет :(

     email: "mee.six@gmail.com"

  -  author: "agat"
     id: "18888"
     url: "http://agat.in"
     date: "2010-09-30 17:03:18"
     humandate: "30 Sep, 2010"
     content: | 
       Мой сердечный респект и уважуха! Впечатляет :) Растешь на глазах.
       
       А, откуда у вас столько книг? :)

     email: "aleksij@gmail.com"

  -  author: "Sam"
     id: "18889"
     url: "http://rmcreative.ru/"
     date: "2010-09-30 17:18:40"
     humandate: "30 Sep, 2010"
     content: | 
       Вполне себе нормально работает в эмуляторе оперы: http://www.opera.com/mobile/demo/

     email: "sam@rmcreative.ru"

  -  author: "Sam"
     id: "18890"
     url: "http://rmcreative.ru/"
     date: "2010-09-30 17:21:10"
     humandate: "30 Sep, 2010"
     content: | 
       Немного раздражает «to save a book on your device»: закрыла текст и как убрать не ясно. Да и в Opera нет никакого плюса…

     email: "sam@rmcreative.ru"

  -  author: "Михаил"
     id: "18891"
     url: "http://designnotfound.ru/"
     date: "2010-09-30 17:27:40"
     humandate: "30 Sep, 2010"
     content: | 
       О, в андроиде (по крайней мере htc desire) можно даже иконку "книги" на экран положить. Очень вкусно.

     email: "mikhail.baranov@gmail.com"

  -  author: "akella"
     id: "18892"
     url: "http://cssing.org.ua"
     date: "2010-09-30 17:34:21"
     humandate: "30 Sep, 2010"
     content: | 
       Я там повесил ontouchstart и onclick ( на «to save a book on your device») - по ним фигня убиралась. Еще был таймаут на 10 секунд, но его-то вот я как раз и убрал, решил не нужен. Видимо надо вернуть, а то на мобильниках же нет клика.
       
       @Михаил, mee Спасибо за фидбек, неужели мечта так близко, можно сделать одно приложение для всех :)

     email: "akella.a@gmail.com"

  -  author: "Сергей Цепелев"
     id: "18893"
     url: "http://tsepelev.ru"
     date: "2010-09-30 20:09:20"
     humandate: "30 Sep, 2010"
     content: | 
       А как сделан нотификатор о возможности добавления иконки на HomeScreen?

     email: "sergey@tsepelev.ru"

  -  author: "MyFreeWeb"
     id: "18894"
     url: "http://myfreeweb.ru"
     date: "2010-09-30 20:22:10"
     humandate: "30 Sep, 2010"
     content: | 
       SVG чтобы видел Firefox, надо использовать object, а не img. Но у object есть косяки с ресайзом в вебките. Проще на сервере их опеределять и подставлять чего надо (:

     email: "me@myfreeweb.ru"

  -  author: "akella"
     id: "18895"
     url: "http://cssing.org.ua"
     date: "2010-09-30 22:36:07"
     humandate: "30 Sep, 2010"
     content: | 
       Та, костыли такие неприятные, зачем мудрить если нет мобильного ФФ =)
       Определять на сервере браузер для SVG - очень неправильно. Нужно определять фичу джаваскриптом.
       Потому что когда выйдет новый фаерфокс который будет поддерживать SVG такой серверный скрипт не покажет ему SVG.

     email: "akella.a@gmail.com"

  -  author: "Дайджест недели, 1 октября - shlema - блог разработчиков"
     id: "18896"
     url: "http://www.developers.org.ua/archives/shlema/2010/10/01/digest-16/"
     date: "2010-10-01 14:05:32"
     humandate: "01 Oct, 2010"
     content: | 
       [...] хроники реализации «проекта за 33 часа» (один участник, другой участник), в рамках которого было создано универсальное [...]

     email: ""

  -  author: "lusever"
     id: "18897"
     url: "http://lusever.ru"
     date: "2010-10-01 16:39:16"
     humandate: "01 Oct, 2010"
     content: | 
       Идея и реализация просто супер. Мне кажется вам не хватает серверного программиста для полного счастья )

     email: "ufokorpas@mail.ru"

  -  author: "akella"
     id: "18898"
     url: "http://cssing.org.ua"
     date: "2010-10-01 17:24:44"
     humandate: "01 Oct, 2010"
     content: | 
       Тут ты совершенно прав, мои PHP-потуги выглядят достаточно забавно, особенно изнутри :)

     email: "akella.a@gmail.com"

  -  author: "D. Sohin"
     id: "18900"
     url: ""
     date: "2010-10-03 22:17:22"
     humandate: "03 Oct, 2010"
     content: | 
       &gt; зачем мудрить если нет мобильного ФФ
       Пользователи Fennec под Maemo на N800, N900 и пр. будут огорчены вашей эрудицией
       Ещё иногда можно просто использовать .xml (см. http://stackoverflow.com/questions/1114561/inline-svg-in-html-with-firefox-3-5)

     email: "d@sohin.de"

  -  author: "Akella"
     id: "18901"
     url: "http://Cssing.org.ua"
     date: "2010-10-03 23:06:46"
     humandate: "03 Oct, 2010"
     content: | 
       Огорчаться им следует в первую очередь из-за своей численности ;-), которая для меня эквивалентна слову "нет"

     email: "Akella.a@gmail.com"

  -  author: "D. Sohin"
     id: "18902"
     url: ""
     date: "2010-10-04 02:41:55"
     humandate: "04 Oct, 2010"
     content: | 
       Что не отменяет их наличие и ваше ущемляющее безразличие

     email: "d@sohin.de"

  -  author: "Akella"
     id: "18903"
     url: "http://Cssing.org.ua"
     date: "2010-10-04 05:13:13"
     humandate: "04 Oct, 2010"
     content: | 
       Так ведь я и не спорю. Только речь ведь о том чтобы ради этого прямо скажем редкого браузера я писал говнокод с хаками? И это ради картинок - некритичного функционала. Увольте. Не умеет свж, так не увидит а о том как не через задницу показывать там иконки я написал в посте но сделать пока на живом проекте не успел. =( Тут действительно моя вина.
       К тому же насколько я понимаю у устройств феннека пока нет экранчиков где они смогут отличить растр от вектора:-)

     email: "Akella.a@gmail.com"

  -  author: "Дима"
     id: "18917"
     url: "http://twitter.com/d1b"
     date: "2010-10-15 11:07:01"
     humandate: "15 Oct, 2010"
     content: | 
       Все девайсы на Maemo с большими экранами как по габаритам так и по разрешению. Говорю как бывший владелец N800.

     email: "s4b@ua.fm"

  -  author: "akella"
     id: "18918"
     url: "http://cssing.org.ua"
     date: "2010-10-15 11:14:37"
     humandate: "15 Oct, 2010"
     content: | 
       Да, но я скорее о плотности пикселов чем о размере.
       Там действительно будет видно разницу между вектором и растром?
       Если так, то возможно и правда стоит :)

     email: "akella.a@gmail.com"

  -  author: "Stepan"
     id: "18919"
     url: "http://freedommaster.ru"
     date: "2010-10-18 11:10:05"
     humandate: "18 Oct, 2010"
     content: | 
       Полезно только тем, у кого стандартная не работает я так понимаю?

     email: "stepankropivin@mail.ru"

  -  author: "RE"
     id: "18920"
     url: ""
     date: "2010-10-20 09:23:27"
     humandate: "20 Oct, 2010"
     content: | 
       Так какой формат книг-то?

     email: "re@re.re"

  -  author: "Jman"
     id: "18929"
     url: "http://myopinion.net.ua"
     date: "2010-10-31 08:46:33"
     humandate: "31 Oct, 2010"
     content: | 
       Очень неудобный поиск, сортировка по авторам была бы удобнее.
       ЗЫ. Нортон есть?

     email: "jman.ua@gmai.com"

  -  author: "Андрей Кравец"
     id: "22105"
     url: "http://saitos.ru"
     date: "2011-09-24 17:46:53"
     humandate: "24 Sep, 2011"
     content: | 
       хорошая статья, спасибо автору

     email: "mr.kravec1983@mail.ru"

  -  author: "AlexWin"
     id: "23389"
     url: "http://windows7seven.ru/"
     date: "2011-10-19 15:41:43"
     humandate: "19 Oct, 2011"
     content: | 
       Статья - то хорошая, только продолжение бы почитать.

     email: "procsi3@gmail.com"

  -  author: "Sergey X."
     id: "22481"
     url: "http://onlinegamenews.ru/"
     date: "2011-10-03 21:47:26"
     humandate: "03 Oct, 2011"
     content: | 
       Я зашел на указанный сайт http://reader.org.ua со своего андрод телефона - но там совсем другой сайт сейчас. 
       Подскажите что случилось с сайтом? Или я что-то не так делаю?

     email: "xain@mail.ru"

  -  author: "Евгений"
     id: "53795"
     url: "http://prfo.ru"
     date: "2012-05-06 21:01:18"
     humandate: "06 May, 2012"
     content: | 
       there’s some great looking stuff in there.

     email: "postmaster@vestiyuga.ru"

layout: "layouts/post.njk"
excerpt: "Вдохновились вместе с <a href=\"http://mega.genn.org/\">genn.org</a> и за сутки сделали полноценную <a href=\"http://reader.org.ua/\">читалку для айфона</a>, андроида, и всех кто поддерживает html5 чуть лучше утюга. О дизайне <a href=\"http://mega.genn.org/2010/33-hrs-project/\">читайте в блоге у Гены</a>, остальное у меня здесь и сейчас. Все очень просто. 

"
---

Вдохновились вместе с <a href="http://mega.genn.org/">genn.org</a> и за сутки сделали полноценную <a href="http://reader.org.ua/">читалку для айфона</a>, андроида, и всех кто поддерживает html5 чуть лучше утюга. О дизайне <a href="http://mega.genn.org/2010/33-hrs-project/">читайте в блоге у Гены</a>, остальное у меня здесь и сейчас. Все очень просто. 

<!--more-->
Реклама, пам-пам:
Пользуясь случаем хочу анонсировать мастер-класс <a href="http://www.smartme.com.ua/speedsite-workshop/">Николая Мациевского об ускорении сайтов</a> (он кстати написал про это две книги, и участвует в W3C), 9 октября в Киеве.
<h3>Зачем оно вообще могло понадобиться?</h3>
Дело в том, что год назад я перепрошил свой айфон на чужом компьютере. И этот бедняга, уроженец Сан-Франциско, и без того залоченный, еще и заглючил. Я больше не смог ставить ничего из AppStore, и использование мной i2reader закончилось. Да, вот такой какой-то глюк с аккаунтами в itunes.

Но, я люблю читать, и любовь эта, словно солнцелюбивое растение пыталась продраться сквозь тьму глюков айфона, к сияющему солнцу знаний, что сулили мне книги.

Я решил сделать читалку на HTML. После исследования этого вопроса, оказалось что меня спасёт HTML5. Стандарт еще не вышел, а уже помог мне прочитать несколько книг! Это для тех кто вечно спрашивает когда же HTML5 станет реальностью. Так вот, правильный ответ &#8212 вчера.  

А потом мы c <a href="http://genn.org">Геной</a> вдохновились и решили сделать проект супербыстро. Хотя идея жила во мне давно. Так и получился этот проект за сутки:
<p class="img con"><a href="http://reader.org.ua/"><img src="http://cssing.org.ua/pic/reader/1.jpg" width="320" height="480"></a><span>Вот так это выглядит на моем iPhone 3G</span></p>
Сразу оговорюсь, проект конечно же заточен под Webkit, просто потому что у меня айфон, а не что-то там еще с Оперой. И в Хроме и Сафари он выглядит ближе всего к дизайнерскому. Можно конечно заставить его выглядеть везде одинаково, но за сутки я этого не хотел и не мог сделать. Потом, ок.

Формально проект состоит из двух частей: каталога книжек (обычная себе версия сайта под айфон), и собственно книжки, в которой и есть элемент того самого HTML5.


<h3>Каталог</h3>
Обычный сайт, но в разработке столкнулись с интересными моментами.

Так как пикселов на новом экранчике iPhone 4 ровно в 4 раза больше чем в старых. То иконки в формате PNG выглядели достаточно размыто и не очень клёво. Однако, мы перевели их все в SVG (ага, именно поэтому пользователи Фаерфокса не видят иконок вообще) и на новых айфонах они выглядят просто офигительно. Чего и вам советую при разработке сайтов под айфон.

<p class="img"><img src="http://cssing.org.ua/pic/reader/5.png" width="540" height="348"><span style="display:block;clear:both;">Вверху то, как это выглядит на старых айфонах (почти не видно разницы), а ниже скриншот из iPhone 4. Угадайте где PNG, а где SVG.</span></p>


Кстати, проверить поддерживает ли браузер SVG можно таким образом:
<ol class="code">
<li>if (document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape", "1.1")) { </li>
<li class="tab">...а тут например добавить class для body</li>
<li>}<li>
</ol>



Кроме этого, все градиенты сделаны через CSS, и потому выглядят всегда идеально и меняются достаточно легко.
<h3>Причем тут html5?</h3>
Это вторая часть сервиса.

В проекте используется часть спецификации называемая <a href="http://dev.w3.org/html5/spec/Overview.html#appcache">application cache</a> и local storage (это вместо кук, только чтобы запомнить место последнего чтения книжки). Хорошая новость, что их почти все браузеры поддерживают. В том числе Сафари на iPhone.

Суть примерно такова: мы можем заставить браузер закешировать какие-то картинки и скрипты. То есть, при открытии этой страницы браузер не будет их запрашивать. Более того, если у вас не будет интернета, то браузер все равно откроет эту страницу, и покажет вам закешированную в последний визит копию вместе с картинками и джаваскриптом.

Синтаксис примерно такой:
<ol class="code">
<li>&lt;!DOCTYPE HTML&gt;</li>
<li>&lt;html manifest="reader.manifest"&gt;</li>
</ol>
А внутри файла что-то вроде этого:
<ol class="code">
<li>CACHE MANIFEST</li>
<li>js/jquery.js</li>
<li>css/style.css</li>
<li>img/read.png</li>
<li>img/read-gr.png</li>
</ol>
(вообще говоря это точная копия с reader.org.ua)

На самом деле в стандарте есть еще куча наворотов, но они мне не нужны были, вы же можете <a href="http://dev.w3.org/html5/spec/Overview.html#appcache">почитать</a>.

Собственно это я и проделал, я сделал страницу с текстом книги <em>офлайновым приложением</em>. 

В результате, открыв лишь однажды страницу с книжкой, она становится вам доступна навсегда, даже когда у вас нет интернета.
Но, доступна в браузере. То бишь чтение бы выглядело как-то так:

<p class="img con"><img src="http://cssing.org.ua/pic/reader/2.jpg" width="320" height="480"><span>Много пространства занято совершенно не относящимся к чтению интерфейсом</span></p>

Тут на помощь приходят всякие крутые метатеги которые работают только для продуктов Apple:
<ol class="code">
<li>&lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt;</li>
<li>&lt;meta name="apple-mobile-web-app-status-bar-style" content="black" /&gt;</li>
</ol>
<a href="http://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariWebContent/Introduction/Introduction.html">Подробнее о них на сайте apple.com</a>.

В результате, если сохранить этот сайт на ваш Home Screen (в айфоне для этого есть кнопка «+» в сафари). Он превращается в нечто похожее на обычное приложение:
<p class="img con"><img src="http://cssing.org.ua/pic/reader/4.jpg" width="320" height="480"><span>Здесь у меня сохранено много книг, в 4-й прошивке думаю их логично группировать</span></p>
И после запуска выглядит вот так:
<p class="img con"><img src="http://cssing.org.ua/pic/reader/3.jpg" width="320" height="480"><span>Максимально используется экран, никаких баров, ничего лишнего. Кроме этого, уже не нужен интернет чтобы читать эту книгу.</span></p>


На этом мы и остановились пока. Нельзя сказать что это приложение должно заменить ваше нативное. (хотя в четвертом айфоне разница по скорости с нативными не заметна вовсе). 
Но для меня оно стало спасением, возможно пригодится и кому-то еще, как демонстрация или вдохновение, или для чтения. 


<h3>Полезные ссылки</h3>
<ul>
<li><a href="http://reader.org.ua">reader.org.ua</a></li>
<li><a href="http://mega.genn.org/2010/33-hrs-project/">Пост на genn.org про дизайн интерфейса</a></li>
<li><a href="http://matt.might.net/articles/how-to-native-iphone-ipad-apps-in-javascript/">HOWTO: Create native-looking iPhone/iPad applications from HTML, CSS and JavaScript</a></li>
<li><a href="http://developer.apple.com/library/safari/#documentation/iPhone/Conceptual/SafariJSDatabaseGuide/OfflineApplicationCache/OfflineApplicationCache.html%23//apple_ref/doc/uid/TP40007256-CH7-SW1">для девелоперов на apple.com</a></li>
</ul>



Из того что пока не удалось до конца победить или успеть:
<ul>
<li>В каталоге порядка 10 000 книг, но есть дубли и пустышки. Скоро надеюсь залить новую базу.</li>
<li>Настройки для чтения: размер и цвет текста и фона</li>
<li>Если у вас не iPhone 3gs или 4 то может ощутимо тормозить и долго все делать</li>
<li>Все что вызвано предыдущим пунктом, иногда лучше подождать, пока что-то произойдет</li>
<li>Пока только portrait mode.  Не придумал как сочетать оба.</li>
<li>Постраничное перелистывание, есть идеи, но это уже сложнее чем 10 часов :)</li>
</ul>
Буду рад мнениям, советам и идеям. Или тому на что это вас может вдохновить.
