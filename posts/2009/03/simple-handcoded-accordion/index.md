---
title: "Простой аккордеон"
date: "2009-03-30"
humanDate: "30 Mar, 2009"
permalink: "2009/03/30/simple-handcoded-accordion/"
tags: 
  - "xhtmlcss"
  - "useful"
comments: 
  -  author: "Алматинский полубомж"
     id: "18574"
     url: "http://polu-bomj.ru/"
     date: "2010-04-17 15:09:36"
     humandate: "17 Apr, 2010"
     content: | 
       Главное чтобы индексировались поисковиками такие вот менюшки. Полезная штука когда в меню очень много категорий и вертикальное нужно прокручивать. Хотя судя по кода проблем быть не должно.

     email: "mig29_vmvp@inbox.ru"

  -  author: "MadDorris"
     id: "14819"
     url: ""
     date: "2009-10-02 10:54:37"
     humandate: "02 Oct, 2009"
     content: | 
       Прикольно, но:
       
       пример с дегающимся нижним краем работает чисто (ну кроме дергающегося края). 
       А вот готовый вариант немного бажит - если кликать быстро, то с каждым кликом гармошка становится все меньше и меньше пока почти совсем не сойдет на нет. 
       Конечно этим можно пренебречь - вряд ли кто-то будет с такой скоростью кликать по меню... Но все же... 
       
       А так возможность интерестная.

     email: "maddorris@gmail.com"

  -  author: "akella"
     id: "14706"
     url: "http://cssing.org.ua"
     date: "2009-08-18 22:03:16"
     humandate: "18 Aug, 2009"
     content: | 
       эмм, а в чем его кошерность? там вроде обычный банальный вариант, и отделения там разной высоты...
       ?

     email: "akella.a@gmail.com"

  -  author: "barbuza"
     id: "14704"
     url: "http://www.barbuza.info/"
     date: "2009-08-16 16:20:00"
     humandate: "16 Aug, 2009"
     content: | 
       кошерный вариант
       http://moofx.mad4milk.net/

     email: "barbuzaster@gmail.com"

  -  author: "cuba"
     id: "14700"
     url: ""
     date: "2009-08-11 05:32:06"
     humandate: "11 Aug, 2009"
     content: | 
       А как же <a> чтобы со ссылками.

     email: "blakeblake@ukr.net"

  -  author: "akella"
     id: "14410"
     url: "http://cssing.org.ua"
     date: "2009-04-28 16:41:23"
     humandate: "28 Apr, 2009"
     content: | 
       Высота должна быть одинаковая у всех блоков, иначе ж будет двигаться нижняя кромка. Можно просто джаваскриптом считать максимальную из всех будущих расхлопывающихся блоков и задавать её всем остальным

     email: "akella.a@gmail.com"

  -  author: "cinic"
     id: "14409"
     url: "http://pepyaka.net"
     date: "2009-04-28 16:27:59"
     humandate: "28 Apr, 2009"
     content: | 
       Akella, а высоту контейнерам обязательно задавать принудительно или возможно не задавать?

     email: "stormspb@list.ru"

  -  author: "homm"
     id: "14400"
     url: ""
     date: "2009-04-24 12:15:32"
     humandate: "24 Apr, 2009"
     content: | 
       Пример из пункта 3 почти хорош, только если быстро нажимать он схлопывается и уже не разворачивается.

     email: "homm86@gmail.com"

  -  author: "delaf"
     id: "14385"
     url: "http://delaf.ru"
     date: "2009-04-17 21:35:13"
     humandate: "17 Apr, 2009"
     content: | 
       вот так
       http://floomby.ru/content/dZyVUFVfFE/

     email: "delaf@ya.ru"

  -  author: "delaf"
     id: "14384"
     url: "http://delaf.ru"
     date: "2009-04-17 21:34:37"
     humandate: "17 Apr, 2009"
     content: | 
       последний работающий линк, не работает.
       Когда закрываются все пункты, открыть их потом не получается

     email: "delaf@ya.ru"

  -  author: "WebMast"
     id: "14351"
     url: "http://bitby.net/"
     date: "2009-04-10 09:30:17"
     humandate: "10 Apr, 2009"
     content: | 
       Так сделает нормальный вариант или стоит пользоваться плагином? Я ноль в JavaScript, поэтому стоп не могу сделать..

     email: "evgen.pm@gmail.com"

  -  author: "akella"
     id: "14350"
     url: "http://cssing.org.ua"
     date: "2009-04-10 00:42:48"
     humandate: "10 Apr, 2009"
     content: | 
       Спасибо!
       А еще лучше имхо создать флаг, чтобы никакая анимация не могла начаться в процессе другой.

     email: "akella.a@gmail.com"

  -  author: "Parkim"
     id: "14346"
     url: ""
     date: "2009-04-08 17:10:08"
     humandate: "08 Apr, 2009"
     content: | 
       При начале новой анимации нужно останавливать все предыдущие. 
       http://docs.jquery.com/Effects/stop.

     email: "sahs@parkim.ru"

  -  author: "Razor"
     id: "14336"
     url: "http://webarium.blogspot.com"
     date: "2009-04-06 00:17:23"
     humandate: "06 Apr, 2009"
     content: | 
       хорошая штучка.. вот только реально при быстром кликанье в итоге все закроется навсегда...
       совсем недавно реализовал свой слайдер.. правда в моем случае все слайдеры работают независимо друг от друга, а сделано это на лысом javascript без всяких фреймворков и занимает всего 2.1 кб.. но получилось довольно универсально..

     email: "razorch@gmail.com"

  -  author: "akella"
     id: "14328"
     url: "http://cssing.org.ua"
     date: "2009-04-03 23:32:16"
     humandate: "03 Apr, 2009"
     content: | 
       Скачет, но по-разному, в одном варианте сильно и все время, в другом чуть-чуть и иногда ;) я считаю это выгодной сделкой с браузером у которого пара процентов.

     email: "Akella.a@gmail.com"

  -  author: "птюч"
     id: "14326"
     url: "http://idcontent.com"
     date: "2009-04-03 19:09:44"
     humandate: "03 Apr, 2009"
     content: | 
       Однако ты азартен, Akella. Этож надо в наше время 7 килобайт экономить. Школа!

     email: "andrey.stefanenko@gmail.com"

  -  author: "Oracle"
     id: "14327"
     url: ""
     date: "2009-04-03 20:22:00"
     humandate: "03 Apr, 2009"
     content: | 
       Абсолютно во всех примерах в Safari (mac) скачет низ. Для последнего работающего примера это можно увидеть, нажав сразу же на пункт «Подписаться». Safari 3.2.1.

     email: "sergey.oracle@gmail.com"

  -  author: "akella"
     id: "14308"
     url: "http://cssing.org.ua"
     date: "2009-03-30 12:47:43"
     humandate: "30 Mar, 2009"
     content: | 
       Для меня jquery, потому что когда стали появляться фреймворки, о нем мне первом рассказали. Да и такой понятный синтаксис, а это всегда приятно, взять и сразу что-то делать. Примерно как с HTML.
       
       @ScorpAL да, в живом скрипте я еще делал защиту, чтобы во время анимации события не обрабатывались, но тут решил не усложнять. Я в целом хотел рассказать именно про <code>step</code>, про который нигде так и не нашел документации (но где-то по слухам есть)
       
       @Mourner - дадада, когда сделал фон для разворачиваемых пунктов, мой фф/mac тоже стал глючно прорисовывать :) Но я решил оставить, всегда забавно видеть столь редкие баги в ФФ =)

     email: "akella.a@gmail.com"

  -  author: "Mourner"
     id: "14306"
     url: "http://agafonkin.com"
     date: "2009-03-30 12:29:36"
     humandate: "30 Mar, 2009"
     content: | 
       Хорошо. :) Только у меня какие-то глюки в FF3/Win со всеми вариантами выскакивают - рисуются странные синие полоски в некоторых случаях и пропадают при перерисовке окна браузера (например при ресайзе).

     email: "agafonkin@gmail.com"

  -  author: "ScorpAL"
     id: "14307"
     url: ""
     date: "2009-03-30 12:39:57"
     humandate: "30 Mar, 2009"
     content: | 
       Нашел ошибочку.
       
       Попробуйте быстро покликать по менюшке.
       
       Нажмите на один пунк меню, и пока происходить эффект слайдинга тут же нажмите на другой пункт меню. Попробуйте проделать так несколько раз.

     email: "scorpal@gmail.com"

  -  author: "Арнольд"
     id: "14309"
     url: "http://olhado.pp.ru"
     date: "2009-03-30 13:39:18"
     humandate: "30 Mar, 2009"
     content: | 
       В <a href="http://cssing.org.ua/examples/acco/" rel="nofollow">примере&gt;</a> в FF 3.0.8 при переключении пунктов на блоках остаются артефакты…

     email: "site-slv@yandex.ru"

  -  author: "cr_"
     id: "14304"
     url: ""
     date: "2009-03-30 12:06:59"
     humandate: "30 Mar, 2009"
     content: | 
       всегда удивлялся, почему именно jquery?

     email: "slim.me@mail.ru"

  -  author: "DiS"
     id: "14305"
     url: "http://www.dis.dj"
     date: "2009-03-30 12:13:49"
     humandate: "30 Mar, 2009"
     content: | 
       » cr_: всегда удивлялся, почему именно jquery?
       
       да хотя бы потому, что он активно развивается, а также поддерживается огромным коммьюнити.

     email: "kirill.konshin@gmail.com"

  -  author: "akella"
     id: "14310"
     url: "http://cssing.org.ua"
     date: "2009-03-30 13:55:42"
     humandate: "30 Mar, 2009"
     content: | 
       Убрал оттуда фоновую картинку, чтобы артефакты никого не смущали, но надо бы отсабмитить им багрепорт по этому поводу.

     email: "akella.a@gmail.com"

  -  author: "nice"
     id: "14317"
     url: "http://aos.com.ua"
     date: "2009-03-31 11:53:21"
     humandate: "31 Mar, 2009"
     content: | 
       Спасибо! Недавно сам искал похожее...

     email: "teg@ukr.net"

  -  author: "Del'ka"
     id: "14318"
     url: "http://delka.name"
     date: "2009-03-31 19:48:40"
     humandate: "31 Mar, 2009"
     content: | 
       Если jQerry не используется, а аккордеон нужен поможет вот этот замечательный js: http://www.dezinerfolio.com/2007/07/19/simple-javascript-accordions
       1kb кода)

     email: "delka@anime.kharkov.ua"

  -  author: "Genn"
     id: "14312"
     url: "http://genn.org/"
     date: "2009-03-30 17:43:02"
     humandate: "30 Mar, 2009"
     content: | 
       Ну и противное название «аккордеон».

     email: "soap@genn.org"

  -  author: "Вдюпель"
     id: "18833"
     url: ""
     date: "2010-09-22 11:58:48"
     humandate: "22 Sep, 2010"
     content: | 
       А как сделать чтобы они были свернуты первоночально?

     email: "dotq@yandex.ru"

  -  author: "Дмитрий"
     id: "27434"
     url: ""
     date: "2011-12-07 14:13:58"
     humandate: "07 Dec, 2011"
     content: | 
       А подскажите плиз, что означает это выражение: toShow = $(this).next();
       toShow - это функция или переменная? Как растолковать?

     email: "dimak@i.ua"

  -  author: "Den1xxx"
     id: "88792"
     url: "http://fromgomel.com/index.php?module=articles&c=articles&b=6&a=14"
     date: "2012-10-22 09:18:09"
     humandate: "22 Oct, 2012"
     content: | 
       Всегда удивлялся почему в подобных аккордеонах скрытые подпункты открываются по клику.
       Это нелогично, особенно если по этому клику может открываться ссылка? Как тогда?
       Я тоже искал подобный вариант, и потом в конце концов написал сам, уложившись в 6 строчек кода на jQuery: http://fromgomel.com/index.php?module=articles&amp;c=articles&amp;b=6&amp;a=14
       Суть: 
       1. Скрыть всех детей при загрузке страницы.
       2. При наведении на родителя переключить высоту детей. Т.е. если было скрыто — открыть, и наоборот.
       3. Чтобы "не дергалось" — п.2 должен срабатывать только если высота не переключается в данный момент. Что делается селектором :not(:animated)
       При таком подходе если у людей не включен яваскрипт, то все "дети" останутся открыты и доступны для клика, что есть хорошо. 
       И да, самый лучший подход — это не "плагины", в которых до 70% занимают комментарии, копирайты и установки переменных, а написать самому. Тем более если задача ясна и проста.

     email: "postmaster@fromgomel.com"

  -  author: "slowProg"
     id: "39373"
     url: "http://paperplane.su"
     date: "2012-02-06 12:28:44"
     humandate: "06 Feb, 2012"
     content: | 
       Отлично! Спасибо автору! 
       
       Всегда хорошо, когда человек не останавливается на плагинах, а ищет правильное и меньшее по размерам решение. За это отдельное ОГРОМНОЕ СПАСИБО. Мне вы сэкономили примерно столько же времени сколько потратили на поиск этого решения =)

     email: "paperplanesu@rambler.ru"

  -  author: "se"
     id: "113384"
     url: "http://consei.ru"
     date: "2012-12-19 15:26:37"
     humandate: "19 Dec, 2012"
     content: | 
       Что то пример в chrome глючит...

     email: "se_ost@mail.ru"

layout: "layouts/post.njk"
excerpt: "Это те самые, странно разворачивающиеся и очень редко нужные менюшки. ;)"
---

Это те самые, странно разворачивающиеся и очень редко нужные менюшки. ;)<!--more-->
Так как jquery стал почти стандартом в индустрии, дальше я буду говорить только о нем.
<h3>Проблема</h3>
На сайте понадобился такой элемент. Выглядят они <a href="http://cssing.org.ua/examples/acco/">обычно как-то так</a>. Я буду считать что один из его блоков должен быть всегда открыт, но на деле, это не очень важно.
Ну и предполагаем, что по невероятному совпадению на сайте уже есть jquery. Потому что подключать его только ради меню глупо, согласитесь. Но, если очень хочется, то, как всегда, можно.
HTML &#8212; обычный <code>dl</code>, в котором <code>dt</code> будут кликаться, а <code>dd</code> раскрываться, вот такой:
<ol class="code">
<li>&lt;dl&gt;</li>
<li>&lt;dt class=&quot;b-acc&quot;&gt;Заголовок&lt;/dt&gt;</li>
<li>&lt;dd&gt;</li>
<li class="tab">Контент</li>
<li>&lt;/dd&gt;</li>
<li>...</li>
</ol>
И все видимые блоки имеют фиксированную высоту 150px.
<h3>#1: Своими силами</h3>
Сделать такой эффект своими силами вроде бы совсем несложно. Всего-то нужно схлопывать-расхлопывать два блока одновременно.
<ol class="code">
<li>$(".b-acc").click(function(){</li>
<li class="tab">if($(this).hasClass('b-acc-active')) {</li>
<li class="tabtab"><small>// сделать что-то если блок уже открыт</small></li>
<li class="tabtab">}</li>
<li class="tab">else{</li>
<li class="tabtab">$("dd:visible").slideUp();<small>// закрыть &laquo;видимый&raquo; блок</small></li>
<li class="tabtab">$(this).next().slideDown();<small>// открыть новый блок</small></li>
<li class="tabtab"><small>// и переключить класс b-acc-active</small></li>
<li class="tabtab">...</li>
<li class="tabtab">}</li>
<li class="tab">return;</li>
<li>});</li>
</ol>
Можно <a href="http://cssing.org.ua/examples/acco/index_simple.html">посмотреть в работе</a>. На первый взгляд все отлично.
Однако, если присмотреться, во время анимаций нижняя граница аккордеона скачет. В некоторых проектах на это и можно закрыть глаза, но когда под аккордеоном куча контента, который будет прыгать на 1-2 пикселя, это очень неприятно.
Пришлось искать решение.
<h3>#2: Плагин</h3>
Это будет первое что вы нагуглите. Проще всего его подключить и вызвать. И если всем плевать на размер файла, а также на то, что вы подключили кучу мусора (разве что ваш сайт будет увешан всеми видами аккордеонов). На этом можно и закончить уже разработку.

Я сделал простой <a href="http://cssing.org.ua/examples/acco/index_plugin.html">пример работы плагина</a>. Нижняя кромка больше не прыгает.
Однако добавилось <em>8 Кбайтов плагина</em>.
<h3>#3: Улучшенный вариант</h3>
Но так хотелось все оставить простым, так не хотелось подключать кучу лишнего кода, который, я знал, никому на сайте уже не понадобится. И я решил раскопать проблему, почему же нижняя граница дергается, и как это все исправить.
В конце концов оказалось, что функции slideUp и slideDown меняют высоту блоков не по целым значениям. То есть, в процессе анимации высоте блока присваиваются значения вроде  2.157305232px. При этом, округление в браузерах работает очень по-разному, что и приводило к &laquo;вибрации&raquo; нижней кромки аккордеона.

Наконец забравшись в недра плагина, я нашел решение, которое также познакомило меня с малоизвестными возможностями jquery.
Идея примерно такая: мы начинаем &laquo;схлопывать&raquo; видимый блок, при этом, на каждом шаге анимации, рассчитывать высоту расхлопываемого блока так, чтобы сумма их оставалась константой.  То есть, если на каком-то шаге высота закрываемого 50 пикселей, то высота открываемого будет 100 (в сумме 150px).

Для этого в jquery есть специальный механизм. В функции animate, есть возможность исполнять что-то на каждом шаге анимации. Называется этот коллбэк &#8212; step.
Финальное работающее решение выглядит примерно так:
<ol class="code">
<li>toShow = $(this).next();</li>
<li>toHide = $(".accordion dd:visible");</li>
<li>&nbsp;</li>
<li>staticheight = toHide.height(); <small>//определить высоту блоков, 150px</small></li>
<li>toShow.css({ height: 0,display: 'block' }); <small>// открываемый делаем "видимым" с высотой 0, теперь он готов к анимации</small></li>
<li>toHide.animate({height:"hide"},{ <small>// начинаем скрывать видимый</small></li>
					<li class="tab">step: function(now) { <small>// на каждом шаге выполняем, now - значение height в каждый момент</small></li>
						<li class="tabtab">var current = staticheight - now; <small>// собственно рассчет</small></li>
						<li class="tabtab">if ($.browser.msie || $.browser.opera || $.browser.safari) { <small>// все округляют по-своему</small></li>
							<li class="tabtabtab">current = Math.ceil(current);</li>
						<li class="tabtab">}</li>
						<li class="tabtab">toShow.height(current); <small>// присваиваем высоту</small></li>
					<li class="tab">},</li>
					<li class="tab">duration: 500</li>
<li>});</li>
</ol>
<a href="http://cssing.org.ua/examples/acco/">Работающий пример.</a> Вуаля, нижняя граница опять зафиксирована, и мы сэкономили 7 Кбайт несжатого кода.

Понятно что конкретно этот аккордеон не универсален, но зная как работает step можно легко применить его к любому другому способу.
<h3>В конце</h3>
Все это далеко не rocket science, но мои долгие попытки найти легкое решение этой проблемы приводили только к плагину. Который я, ну никак не хотел подключать. Потому надеюсь кому-то это сэкономит усилия и код. И буду рад услышать ваше мнение об этом.

Разумеется, только ради аккордеона не стоит подключать jquery, но, обычно, сайты с такими навороченными меню содержат еще кучу всяких анимаций и действий. И потому, в результате, все равно удобнее использовать фреймворк для разработки.
<h3>Ссылки</h3>
<ul>
<li><a href="http://docs.jquery.com/UI/Accordion">Плагин для jquery</a></li>
<li><a href="#">Ссылку на документацию step, найти не удалось, был бы благодарен, если кто-то сталкивался</a></li>
<li><a href="http://cssing.org.ua/examples/acco/index_plugin.html">Пример с плагином</a></li>
<li><a href="http://cssing.org.ua/examples/acco/index_simple.html">Пример своими силами</a></li>
<li><a href="http://cssing.org.ua/examples/acco/">Пример своими силами, с зафиксированной нижней кромкой</a></li>
</ul>
