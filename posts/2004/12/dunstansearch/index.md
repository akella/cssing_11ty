---
title: "Поиск Данстана"
date: "2004-12-06"
humanDate: "06 Dec, 2004"
permalink: "2004/12/06/dunstansearch/"
tags: 
  - "xhtmlcss"
  - "useful"
comments: 
  -  author: "Андрюс"
     id: "417"
     url: ""
     date: "2004-12-07 09:00:18"
     humandate: "07 Dec, 2004"
     content: | 
       Кроме поиска у него там масса замечательных вещей показывающихся в слоях без перезагрузки. Вот это меню, например: nv|bm|br*. Ну, а "Panorama information" это вообще нечто! Ты читал как это работает?

     email: "contact@andrius.ru"

  -  author: "Tim"
     id: "418"
     url: ""
     date: "2004-12-07 14:02:55"
     humandate: "07 Dec, 2004"
     content: | 
       XmlHttpRequest будет работать и в Opera с версии 7.6. В снепшотах уже работает. 
       
       А еще у Дунстана меня восхитили подсказки к поиску. Песня.

     email: "tim@zeos.net"

  -  author: "kukutz"
     id: "419"
     url: "http://ar.sky.ru/"
     date: "2004-12-07 14:20:27"
     humandate: "07 Dec, 2004"
     content: | 
       Начнём с того, что LiveSearch придумал Christian Stocker из Bitflux.
       
       Достаточно поискать это слово в Google.
       
       Продолжим тем, что проблему с кодировкой мне удалось решить одним-единственным способом: передавать русские буквы закодированными. UUE, Base64, escape() - выбирайте сами.

     email: "thingol@mail.ru"

  -  author: "akella"
     id: "420"
     url: "http://cssing.iatp.org.ua"
     date: "2004-12-07 16:17:59"
     humandate: "07 Dec, 2004"
     content: | 
       Спасибо за уточнение. Как то даже не подумал об авторстве.
       
       Конечно читал про погоду. Яркий пример соединения нескольких технологий. А как вам комментарии на его блоге? Это даже не песня это просто хит.
       Да и вообще все это сочетание наворотов смотрится довольно гармонично.

     email: "akella.a@gmail.com"

  -  author: "Андрюс"
     id: "421"
     url: ""
     date: "2004-12-07 18:28:10"
     humandate: "07 Dec, 2004"
     content: | 
       да, ссылки в комментариях, кто кому говорит это круто. Но всЄ же по сравнению с коментариями Ливжурнала ничто не сравнится. К тому же какой-то он не добрый чувак, никому скриптов не даЄт. В вэбе обычно всЄ тяготеет к open source. Так быстрее всЄ развивается, люди развивают и дополняют идеи друг друга.

     email: "contact@andrius.ru"

  -  author: "edgy"
     id: "422"
     url: "http://edgy.ru/"
     date: "2004-12-08 11:08:37"
     humandate: "08 Dec, 2004"
     content: | 
       а как это сервер грузит? там же на каждую букву идет запрос?

     email: "i@edgy.ru"

  -  author: "akella"
     id: "423"
     url: "http://cssing.iatp.org.ua"
     date: "2004-12-08 16:02:12"
     humandate: "08 Dec, 2004"
     content: | 
       Извини, не совсем понятно, о чем ты?
       Результаты поиска?
       Результаты поиска воспринимаются как обычный текст (хотя там и намешаны тэги). После чего через innerHTML заменяют содержимое DIVa этим текcтом.

     email: "akella.a@gmail.com"

  -  author: "edgy"
     id: "425"
     url: "http://edgy.ru/"
     date: "2004-12-09 06:34:20"
     humandate: "09 Dec, 2004"
     content: | 
       сам поиск. я так понимаю, что когда пользователь набирает слово, скрипт при появлении каждой новой буквы отправляет запрос на поиск получившегося слова. то есть при поиске слова из 7 букв будет выполнено семь запросов к серверу, вместо одного при обычном поиске.
       
       Вообще, ИМО, это из разряда свистков и гудков. Я, как и многие, набираю слово целиком, и нажимаю Enter, а не печатаю букву по одной и не смотрю что будет.

     email: "i@edgy.ru"

  -  author: "akella"
     id: "427"
     url: "http://cssing.iatp.org.ua"
     date: "2004-12-09 18:13:24"
     humandate: "09 Dec, 2004"
     content: | 
       Какие то глюки с кодировкой сорри.
       
       Все не совсем так. Там есть задержка. То есть если при наборе ключевого слова вы сделаете перерыв более чем на 2 секунды, то запрос пойдет. Иначе нет. То есть такой вариант продуман.
       Поэтому это совсем не мешает. 
       Более того, если набрать слово и нажать ентер, то этот поиск сработает как и всегда.

     email: "akella.a@gmail.com"

  -  author: "graymur"
     id: "719"
     url: "http://graymur.net/"
     date: "2005-02-18 17:20:01"
     humandate: "18 Feb, 2005"
     content: | 
       http://dklab.ru/chicken/nablas/41.html

     email: "gr@graymur.net"

layout: "layouts/post.njk"
excerpt: "Немного оклемался от революции и на глаза попалась классная штука.
Еще одну великолепную идею подарил нам <a href=\"http://www.1976design.com/blog/\">Данстан Орчард</a>(<a href=\"#update\">уточнение</a>). Если вы еще не знаете попробуйте поискать на его сайте чего-нибудь.(Enter не нажимать!)
"
---

Немного оклемался от революции и на глаза попалась классная штука.
Еще одну великолепную идею подарил нам <a href="http://www.1976design.com/blog/">Данстан Орчард</a>(<a href="#update">уточнение</a>). Если вы еще не знаете попробуйте поискать на его сайте чего-нибудь.(Enter не нажимать!)
<!--more-->
Вот решил разобраться как же такое делать. Вдруг еще кому окажется полезным.
<h3>В чем фишка?</h3>
Главная фишка этого "живого" поиска в том, что страница не обновляется, когда вы ищете что-нибудь. Как это возможно?
<h3>XML HTTP Request</h3>
Не буду излагать всю статью. Главное, что этот объект позволяет javascript делать HTTP запросы и получать на них ответ. Это открывает немерено возможностей.  И одно из самых главных -  мы можем обновлять некоторую информацию на странице <strong>без</strong> ее(страницы) обновления полностью. Подробнее об использовании этого объекта читайте здесь:
<a href="http://jibbering.com/2002/4/httprequest.html">Using the XML HTTP Request object</a>
(там есть некоторые оговорки с поддержкой, но Мозилла и ИЕ работают)
<h3>Не только javascript</h3>
Однако одним джаваскриптом тут не обошлось. Ведь надо получить из базы результаты поиска.  Поэтому скрипт вызывает php файл поиска и оттуда черпает результаты.
<h3>Все вместе</h3>
В целом если опустить мелочи касательно задержек, очистки поиска и тому подобного. То можно так представить этот поиск:
<ol>
<li>Создается объект и примерно такой строкой запрашиваем результат поиска:
<pre>
liveSearchReq.open('GET', processURI+searchInput.value);
</pre>
При этом нам надо использовать специальный скрипт для поиска. Он должен возвращать <strong>не целую страницу</strong>, а лишь тот <strong>кусок HTML кода</strong>, который мы хотим отобразить сразу. То есть лишь результаты поиска.(без тэгов BODY, HTML)
</li>
<li>С помощью <abbr title="Document Object Model">DOM</abbr> создаем <code>DIV</code> в который и пишем эти результаты.</li>
<li>Любуемся "живым" поиском</li>
</ol>

<h3>Наконец</h3>
Блог Данстана это просто кладовая замечательных скриптов. Я наверно не раз еще вернусь и почерпну что-нибудь полезное оттуда.

<h3>Проблема</h3>
Почему то появились глюки с кодировкой. Как я ни гадал ЮТФ и Вин-1251 не подходят.
Причем ИЕ кодировку почему то угадывает.
А как бороться в других случаях, я так и не смог понять.
Быть может кто-то сталкивался с подобным? Откликнитесь в комменты.

Можно посмотреть на поиск на сайте Данстана, но это неинтересно (там не глючит кодировка :) ) Поэтому вот здесь я привожу вариант с глючной кодировкой.
<a href="http://cssing.iatp.org.ua/antry.php">Мой вариант "живого" поиска.</a>.
Не все там гладко и со стороны Wordpress'a, когда результат поиска одна заметка этот гад (:)) делает переадресацию и выводит и HTML и BODY тэг. Но это не проблема. А вот кодировка...
<h3 id="update">Уточнение</h3>

<strong>Восстанавливая справедливость.</strong>
Авторство данной техники принадлежит Christian Stocker.
И подробнее о ней можно прочитать здесь
<a href="http://blog4.bitflux.ch/wiki/LiveSearch" title="LiveSearch">http://blog4.bitflux.ch/wiki/LiveSearch</a>
