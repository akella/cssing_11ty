---
title: "Печатная версия с Javascript"
date: "2007-04-07"
categories: 
  - "xhtmlcss"
---

Я всегда знал два подхода к печатным версиям: старого типа - ставим ссылку "печатная версия", пользователь переходит на новую страницу и видит печатную версию этой же страницы, и новый: добавляем css media="print", и только знающие люди могут нажать Print Preview или догадаться распечатать эту страницу. Вот и пришла маленькая идея комбинации лучших сторон этих двух подходов.

### Что я хочу

А хочу я, что бы по клику на ссылку "печатная версия" какой то волшебник заменял media="print" на media="screen", и страница преображалась без перезагрузки в печатный вид. Таким образом и пользователь экономит время(хоть и мизерное), и видит сам печатный вид без лазания по меню броузера. Вроде как - все довольны.

### HTML

Для примера понадобится страница с печатной версией, это будет [что то вроде этой](http://cssing.org.ua/examples/printwithjs/). В head файла добавим print.css два раза для разных медиа:

1. <!--Для собственно принтеров -->
2. <link rel="stylesheet" type="text/css" media="print" href="css/print.css" />
3. <!--Для нашего превью с джаваскриптом -->
4. <link rel="alternate stylesheet" type="text/css" media="screen,projection" href="css/print.css" title="printview" disabled />

Атрибут disabled указан для того что бы в ИЕ эти стили корректно включались и отключались.([см. статью](http://www.quirksmode.org/js/cssdisable.html))

Теперь страничка полноценная - у нее есть печатная версия, и она нормально отображается в броузерах. Дело за магией.

### Javascript

Нам необходимо как то переключаться между стилями, приходят на ум статьи о [Style Switcher](http://alistapart.com/stories/alternate/) и тому подобных, однако его я считаю черезчур избыточным, он скорее предназначен для переключения разных вариантов дизайна или шрифтов. А запоминания в куку в данном случае явно излишни.

Потому я обратился к другой статье(спасибо [CB](http://sudoku.org.ua/rus/blog/) за наводку), где описывается метод буквального отключения [CSS Disabling](http://www.quirksmode.org/js/cssdisable.html) По сути взял с минимальными изменениями джаваскрипт оттуда, вот что я использовал для решения задачи:

function setPrintCSS(isPrint) {
// Определяем поддержку нужного нам элемента в броузерах
  if (document.getElementsByTagName)
      x = document.getElementsByTagName('link');
  else if (document.all)
      x = document.all.tags('link');
  else
  {
      alert('Простите, этот скрипт не работает в вашем броузере');
      return;
  }
// Пробегая по всем элементам LINK в HTML  - включаем и отключаем нужные нам стили
// идентифицируя их по атрибуту title
// параметр isPrint - отвечает просто за вариант стилей для печти или монитора
  for (var i=0;i<x.length;i++) {
      if(x\[i\].title == 'printview'){x\[i\].disabled = !isPrint;}
      if(x\[i\].title == 'screenview'){x\[i\].disabled = isPrint;}
  }
}

(немного более логичный нейминг по сравнению с первым вариантом, спасибо [CB](http://sudoku.org.ua/rus/blog/)) В результате в HTML можно добавить две ссылки вида:

1. <a href="#" onclick="setPrintCSS(false)">Вернуться к стандартному виду</a>
2. <a href="#print" onclick="setPrintCSS(true)">Печатная версия</a>

По клику на которые всё и будет происходить. [Вот простой пример](http://cssing.org.ua/examples/printwithjs/) этого приема.

Можно пойти дальше(спасибо [Smash](#comment-10881) за идею), и позволить пользователям давать ссылку на печатную версию сайта. Для этого достаточно одной строки скрипта после задания нашей функции:

if(document.location.hash=='#print') setPrintCSS(true);

[Смотреть пример с работающим #print.](http://cssing.org.ua/examples/printwithjs/index2.html#print)

### Ссылки

- **Update:** Пример с переработанным кодом, теперь работает #print, [сам пример](http://cssing.org.ua/examples/printwithjs/index2.html) и [печатная версия](http://cssing.org.ua/examples/printwithjs/index2.html#print)(в адрес добавлено #print)
- [Мой пример](http://cssing.org.ua/examples/printwithjs/)
- [Пример из апдейта(см. ниже)](http://cssing.org.ua/examples/printwithjs/index1.html)
- [Статья PPK](http://www.quirksmode.org/js/cssdisable.html)
- [Второй пример](http://akella.org.ua/pro/prostobank/publication.html)
- [Print to Preview](http://alistapart.com/articles/printtopreview) - статья с похожей идеей на алистапарте

Для красоты в media=screen я скрываю ссылку переключения в обычный вид, а в печатной версии соответствующую ссылку на печатную версию.

### В конце

Вот такой маленький приемчик - иногда может быть довольно приятным, да и наконец позволяет более явно использовать нам наши CSS для принтеров. А то бывает пишешь-пишешь эти стили.. А они скопируют в ворд и распечатают по привычке =) Кстати многие любят читать печатные версии на сайтах, что бы ничего не мешало - а таким образом мы ускоряем им это переключение. Вдобавок, можно давать одинаковые тайтлы нескольким ЦСС файлам и они будут отключены все разом. Буду рад услышать Ваши мысли, критику, приемы по этому поводу!

**Обновлено:** Спасибо [Vladson](http://vladson.com/) за второй способ быстрой замены стилей, чуть менее абстрактный, но иногда возможно оптимальный. Задаем параметр id для элемента link(например main-css), и тогда

1. <a href="#" onclick="document.getElementById('main-css').href = 'css/base.css'">Вернуться к стандартному виду</a>
2. <a href="#" onclick="document.getElementById('main-css').href = 'css/print.css'">Печатная версия</a>

Оба споосба еще нуждаются в тестировании - но под виндой работают под всеми броузерами. А последний и под Konqueror.
