---
title: "Одноразовый expression"
date: "2007-12-06"
humanDate: "06 Dec, 2007"
permalink: "2007/12/06/expression-optimization/"
tags: 
  - "xhtmlcss"
  - "useful"
comments: 
  -  author: "STIL"
     id: "18531"
     url: "http://xwall.ru"
     date: "2010-04-06 20:56:42"
     humandate: "06 Apr, 2010"
     content: | 
       Спасибо! а от IE6 давно пора отказаться, тот же хабр игнорирует его существование в своей верстке

     email: "syspasws@mail.ru"

  -  author: "Samter"
     id: "14762"
     url: "http://ebrest.by"
     date: "2009-09-06 10:43:33"
     humandate: "06 Sep, 2009"
     content: | 
       Полностью согласен с AMBA. и вот уже ютуб собирается отказаться от поддержки ИЕ6. И чья теперь это проблема недоступности ресурса?

     email: "denis@rudov.com"

  -  author: "Максим Покровский"
     id: "11429"
     url: "http://pokrovskii.com"
     date: "2007-12-08 14:47:12"
     humandate: "08 Dec, 2007"
     content: | 
       Я стараюсь не злоупотреблять expressions. min-width и png и hover за глаза.
       ИМХО, естественно

     email: "maxim@pokrovskii.com"

  -  author: "akella"
     id: "11430"
     url: "http://cssing.org.ua"
     date: "2007-12-09 12:47:30"
     humandate: "09 Dec, 2007"
     content: | 
       Мне еще иногда приятно попользовать first-child, мы так отвыкли его использовать, что порой уже не замечаем его силы.
       
       Вообще же =) я в душе твикер, и меня нервирует сам факт что эти экспрешны так <a href="http://cssing.org.ua/examples/expression/bad.html" rel="nofollow">часто пересчитываются</a>

     email: "seijuro@yandex.ru"

  -  author: "Евген"
     id: "11446"
     url: ""
     date: "2007-12-11 00:57:42"
     humandate: "11 Dec, 2007"
     content: | 
       А что за хрень такая внизу, 508? По ссылке какие-то непонятные слова на аглицком языке.

     email: "nahodka_went@mail.ru"

  -  author: "akella"
     id: "11447"
     url: "http://cssing.org.ua"
     date: "2007-12-11 11:31:47"
     humandate: "11 Dec, 2007"
     content: | 
       Почитайте http://cssing.org.ua/2004/10/14/russian-508/, хотя выучить аглицкий советую тоже

     email: "seijuro@yandex.ru"

  -  author: "1smash1"
     id: "11499"
     url: "http://1smash1.livejournal.com"
     date: "2007-12-19 08:29:29"
     humandate: "19 Dec, 2007"
     content: | 
       Надо бы сделать для блоков кода горизонтальную прокрутку, на случай если длинная строчка попадется, как в примере экспрешена яндекса.

     email: "smashlong@gmail.com"

  -  author: "тур"
     id: "11554"
     url: "http://www.internet-travel.ru"
     date: "2007-12-25 20:42:58"
     humandate: "25 Dec, 2007"
     content: | 
       Тоже иногда first-child юзаю, но это как раритет какой-то: )

     email: "travel-tur@inbox.ru"

  -  author: "Del'ka"
     id: "11776"
     url: "http://anime.kharkov.ua"
     date: "2008-02-12 19:57:53"
     humandate: "12 Feb, 2008"
     content: | 
       освоил, большое спасибо!

     email: "delka@anime.kharkov.ua"

  -  author: "Tutta"
     id: "12511"
     url: ""
     date: "2008-06-01 14:50:53"
     humandate: "01 Jun, 2008"
     content: | 
       1. Не совсем по теме, но тоже ..
       
       Предлагаю также рассмотреть в отд. посте тему:- "Мифы о ФФ".
       За основу можно принять статью известного гуру веба - Давида Хамунда ( David Hammond )
       http://www.webdevout.net/firefox-myths
       
       
       P.S. [З.Ы.]
       
       Очень рекомендую ресурс. Много СИСТЕМАТИЗИРОВАННОЙ информации по свежим браузерам, CSS, ECMA ... и не только.
       
       2. Совсем не по теме 
       
       Никогда не была шовинистом в отношении определенного браузера. Но, признаюсь, что бывали моменты, когда хотелось убить NN4 , или Оперу, или ослика ИА и Рыжего Лиса !!! в том числе.
       
       Много гуру сломали копий по поводу "логики" стандартов, написанных 3WC в т.ч. и "в пыку" зарвавшейся MS. Даже Сами Отцы стандарта не пришли к общему мнению об этой "логике", приняв мнение большинства своего сообщества.
       
       "Хороший индеец - мертвый индеец" - слова садиста и "людоеда" генерала Першинга.
       
       "Плохой" / "хороший" браузер - понятие из ментальности детей и подростков. 
       Стандартный или нестандартный! Вот в чём вопрос Горацио.
       
       А в остальном о "вкусах не спорят". Ведь нет же проблем верстать под любой браузер В ОТДЕЛЬНОСТИ!
       
       Кстати, ни один браузер не подходит под стандарты носорогов или фиников. Т.е. стандарт не догма, а руководство .. причем, не обязательное а рекомендательное для софт-девелоперов. И если вы не употребляете селёдку с молоком, то никакой стандарт потребления вас не заставаит это делать, поскольку - ЭТО ВАШЕ ЛИЧНОЕ !!
       
       ЛИЧНОЕ ДЕЛО серфера - каким браузером пользоваться. Он нам НИЧЕГО НЕ ДОЛЖЕН!! Ни я, ни вы, ни он, НИКТО не терпит насилия в свой адрес. Поэтому детская демагогия о том, что всех надо ЗАСТАВИТЬ пользоваться стандартным и т.д. дебильна и порочна, по сути, как и демагогия 70 лет советской власти.
       
       Это НАШИ проблемы, поскольку, "соно дэс ару" (яп.)!
       
       Только дети или жлобы пытаются свалить свои обязанности на других. Кроссбраузерность - это наша работа, наша проблема и не надо сваливать свою лень на серфера или девелопера, на MS ли W3C.
       
       P.P.S.
       
       Но паддинги страницы в окне на весь экран монитора - НЕ ДЕЛАЕТ, в соответствии со стандартами 3WC, ваш монитор большего размера!! 
        :)

     email: "springer@mail.ru"

  -  author: "akella"
     id: "12514"
     url: "http://cssing.org.ua"
     date: "2008-06-01 16:13:09"
     humandate: "01 Jun, 2008"
     content: | 
       Спасибо за мнение Tutta! Но почему вы решили его высказать именно в этом посте? :)
       Со всем согласен, все это наши заботы. Что впрочем вовсе не мешает каждому из верстальщиков иметь свой взгляд и свои любимые слова для ИЕ :)
       
       PS: Про паддинги - это вы о чем? О какой странице? Или вообще?

     email: "akella.a@gmail.com"

  -  author: "Tutta"
     id: "12537"
     url: ""
     date: "2008-06-02 09:31:16"
     humandate: "02 Jun, 2008"
     content: | 
       Спасибо Юрий!
       
       Из всех блоггеров вы самый толерантный автор.
       
       Я писала, что "ЭТО НЕ ПО ТЕМЕ". Так что можете удалить тот т.н. "коментарий".
       
       В одном из блогов целая толпа верстальщиков требовала от собратьев по цеху ЗАСТАВИТЬ серфера перейти на "самый-самый" один единственный стандартный браузер. Из монитора из щелей кнопок потекла густая струя яда.
       
       ИЕ мне тоже не нравится, но и ФФ тоже не без .... Иногда некоторые повадки ИЕ очень даже ...
       
       О мониторе? Это в шутку. По поводу стандарта, гласящего, что паддинги увеличивают размер блока.
       
       ! ! !
       
       А всё-таки, с вашим талантом разказчика не откажитесь от моего предложения написать пост "Сказки о Рыжем Лисе". 
       
       По моему скромному ИМХО - это уравновесит "систему". Стереотипы - тормоза развития. В вост. философии умеренность и Гармония это благо. Как говорил Кундзы: - "мера - мера всех вещей". Браузерный "экстремизм" - разрушителен. То, что браузеры разные - только создает возможность каждому проявить свои таланты и способность к гибкому и нестандартному мышлению.
       Естественно, не для обеднённых умом, воображением и не для ленивых.
       
       Юрий, прошу - напишите постик!
       
       
       P.S.
       Я не против (и, даже наоборот - хочу), если вы удалите этот "НЕкомментарий", к-рый, действительно не уместен здесь. 
       Рада с вами общаться.

     email: "springer@mail.ru"

  -  author: "akella"
     id: "12538"
     url: "http://cssing.org.ua"
     date: "2008-06-02 09:49:45"
     humandate: "02 Jun, 2008"
     content: | 
       С Вашего позволения удалять не буду, ибо даже этот ваш комментарий еще один шаг к равновесию.
       
       Я подумаю как это красиво представить, один из факторов что меня удерживают, я уже около года не использую Фаерфокс, и среди читателей тут я не замечал особого фанатизма по поводу рыжего лиса. И вашей тяги к равновесию я еще не успел разделить, ибо не читал всех тех фанатичных сообщений о которых вы говорите,
       Но тема очень интересная, просто я не люблю просто переводить чужой материал (. Мне это уже не очень удобно внутренне.
       
       Вобщем надеюсь вы понимаете мои причины пока не писать этот пост =). Хотя в целом идея мне нравится.
       
       А вот вам Tutta не хватает блога, на находите? :-P

     email: "akella.a@gmail.com"

  -  author: "Tutta"
     id: "12544"
     url: ""
     date: "2008-06-02 12:55:09"
     humandate: "02 Jun, 2008"
     content: | 
       Чем и привлекателен ваш блог, так это тем что в нём, действительно, нет той грубой напористости в затаптывании чужого мнения. Спасибо "модератору", к-рый держит "светский" стиль общения под контролем. Чувствуется нечто из восточных школ совладания с духом - ни одной грубой эмоции и мягко-спокойное спускание пара у эмоционального коментатора.
       
       Речь шла об аутодафе еретиков совершенно на другом блоге.

     email: "springer@mail.ru"

  -  author: "akella"
     id: "12551"
     url: "http://cssing.org.ua"
     date: "2008-06-02 16:46:54"
     humandate: "02 Jun, 2008"
     content: | 
       Вы, право, льстите. Стремиться я б к гармонии хотел.
       
       Про еретиков понял, но я то, тот блог не читал, надо прочесть, проникнуться тягой к броузерной справедливости, и написать :). После общения с разработчиком ИЕ8 я вообще как-то проще стал относиться к броузерам. Потому мне кажется тем затаптывающим мнение нужно лишь время, чтобы понять в чем именно они были не правы.
       
       Забавно, Tutta, у нас с Вами один провайдер =), У вас тоже днем тормозило сегодня? )

     email: "seijuro@yandex.ru"

  -  author: "Tutta"
     id: "12569"
     url: ""
     date: "2008-06-03 17:26:34"
     humandate: "03 Jun, 2008"
     content: | 
       Дело, собственно, не в браузере[ах]. Или не столько в браузерах, а в принципе.
       
       Не приемлем лозунг: - "Загоним железной рукой тупое человечество к счастью пользования лучшим из стандартных средств и-нет серфинга!"
       
       Я против насилия в отн. серфера и разработчика в ЛЮБОЙ форме.
       
       За Свободу серфера выбирать любое ПО!!
       
       Источник экстремизма - предвзятое отношение к одному из браузеров, лень и нетерпимость к мнению и выбору иных.
       
       Какой есть - такой есть. 
       В принципе, стандарт с одной стороны - великое благо, а с другой в нек. роде тормоз для новых идей в разработке. Большинство стандартов в гипертексе и стилях были приняты, как постфакт существующих до момента принятия стандарта свойств "тогодашних" браузеров.
       
       Нетскейп внедрил свой нестандартный Layer - теперь это мертвый тег, как и урод NN4. Но появилось понятие слоя и лавина каскадных таблиц 2-го уровня. То же с JS коллекцией ALL ИЕ5.
       
       Новаторство - это нарушение стандартов. Всегда. И к этому "злу" надо относится спокойно. Ибо, как говорил Лао Дзы - нет зла и добра. Есть РАЗНОЕ. Инь и Янь. Зло - это когда нарушается равновесие между ними т.е. между "разным".
       
       Диалектика, однако!
       
       А заставить всех и вся перейти на единственное "любимое" ПО - это разрушение. Запрет развития.
       
       А првайдер наш - паразит и монополист.

     email: "springer@mail.ru"

  -  author: "akella"
     id: "12578"
     url: "http://cssing.org.ua"
     date: "2008-06-04 13:45:25"
     humandate: "04 Jun, 2008"
     content: | 
       Согласен по всем пунктам. Однако я думаю что мнения этих еретиков по-большому счету, фриков, довольно слабо влияют на общее развитие технологий. Они в меньшистве =) И пока есть вы и я, даже если останется один броузер, мы сможем изучить как их делают, и сделаем свой!
       
       Про провайдера, метко! Зато можно оплачивать вебманями =)

     email: "akella.a@gmail.com"

  -  author: "Tutta"
     id: "12601"
     url: ""
     date: "2008-06-07 09:26:04"
     humandate: "07 Jun, 2008"
     content: | 
       Уважаемый Akella (сразу вспоминается старый чудесный мультик о Маугли), а есть ли у вас в ресурсе "раздел вопросов", где можно задать вам вопрос на тему CSS, HTML, JS ...?
       Во-первых, на форумах вопрос на 3-4 посте вырождается в нечто чуждое изначальному. Редкий мЭтр веба снисходит до общения с лузерами или находит время и т.п. И часто вопрошающий остается ни с чем. 
       Во-вторых, ответ желательно получить компетентный. 
       Вы же Гуру. И всё знаете. Мудры и бщительны. Лучшего O'Cен-сея я бы не нашла.

     email: "springer@mail.ru"

  -  author: "akella"
     id: "13168"
     url: "http://cssing.org.ua"
     date: "2008-08-30 21:51:18"
     humandate: "30 Aug, 2008"
     content: | 
       Был бы счастлив ответить на ваши вопросы. Это еще актуально?

     email: "akella.a@gmail.com"

  -  author: "AMBA"
     id: "13909"
     url: "http://go.co.ua"
     date: "2009-01-01 16:09:15"
     humandate: "01 Jan, 2009"
     content: | 
       Не совсе согласен с мнением что наличие множества нестандартных браузеров, это проблемы исключительно верстальщика. Если свёрстанный ресурс популярен и очень полезен, а конечные пользователи некоторых браузеров лишены ряда возможностей и удобств из-за неподогнанной под их браузер вёрстки, то это уже становится проблемами пользователя, и он начинает искать в каком же браузере нужный ему сайт будет работать так, как нужно.
       Или допустим завтра у гугла появятся уникальные, меганезаменимые фичи в хтмл/цсс не работающие нигде кроме хрома, и параллельно уникальные возможности для пользователей хрома, и начнётся глобальный передел рынка, тогда это будут проблемы производителей софта, сделать модные фичи работающими и у них.
       Tutta - предположим топовых браузера было бы не 3-5, а 30-50 с одинаковой долей популярности, и все со своими особенностями, частично исключающими взаимное использование, и у вас на подгонку среднего сайта под все, уходило бы в среднем пол года, вы бы так же спокойно говорили о том что это проблема верстальщика?
       Комплекснее надо смотреть и шире, стандартизация нужна, иначе без неё будет хаос невыгодный никому.

     email: "web@amba.net.ua"

  -  author: "AMBA"
     id: "13910"
     url: "http://go.co.ua"
     date: "2009-01-01 16:23:58"
     humandate: "01 Jan, 2009"
     content: | 
       P.S. нехороший монополист это воля? А они принимают оплату вебманями?

     email: "web@amba.net.ua"

layout: "layouts/post.njk"
excerpt: "Все уже часто сталкивались с специфическими для IE expressions, однако не все знают (я например не знал), что их можно оптимизировать. Об одном из  приемов и пойдет дальше речь. 
"
---

Все уже часто сталкивались с специфическими для IE expressions, однако не все знают (я например не знал), что их можно оптимизировать. Об одном из  приемов и пойдет дальше речь. 
<!--more-->
<h3>Проблема</h3>
Наверняка многие хакеры замечали, что когда expression становится много, то сайт начинает притормаживать в IE. Оно и понятно &#8212; они ведь исполняются при каждом действии на странице, будь то клик, наведение мышки, или ресайз экрана. <a href="http://cssing.org.ua/examples/expression/bad.html">Cмотрите сами</a>. Для некоторых скриптов так и должно быть (min-width например), другим же достаточно одного выполнения(PNG fix, :first-child etc). О том как заставить их исполняться только один раз при загрузке и идет дальше речь.
<h3>Решение</h3>
Все решения используют один и тот же прием. Есть некий "флаг", при наличии которого expression выполняется, скрипты же пытаются при первом же исполнении этот флаг убрать. 
<h3>Вариант решения</h3>
Первый вариант выглядит так:
<ol class="code">
<li>jscript: expression(</li>
<li class="tab">this.p ? 0 : (</li>
<li class="tabtab">//а здесь пишем нужный нам код,</li>
<li class="tabtab">this.p = 1</li>
<li class="tab">)</li>
<li>);</li>
</ol>
В данном случае в качестве флага используется абстрактное и несуществующее в спецификации свойство "p". При первом выполнении, переменной p будет присвоена 1, а также выполнено наше действие. Таким образом при каждом следующем выполнении скрипта будет выполняться только <code>this.p = 0</code>. Что гораздо быстрее любых других операций.
<h3>Яндекс вариант</h3>
Вариация(false true переставили местами) на тему этого способа используемая в верстке Яндекса:
<ol class="code">
<li>b:expression(</li>
<li class="tab">!this.a?</li>
<li class="tabtab">(this.a=1, (this.previousSibling?this.innerHTML='&amp;nbsp;&amp;middot;' + this.innerHTML:0)):</li>
<li class="tabtab">0</li>
<li class="tab">);</li>
</ol>
В частности, этот скрипт ставит точки-разделители перед всеми "чайлдами", кроме первого &#8212; такая вот эмуляция first-child.
Скорее всего принадлежит руке большого и уважаемого мною профессионала в верстке &#8212; <a href="http://vitaly.harisov.name/">Виталия Харисова</a>
<h3>Второй тип,  я использую</h3>
Есть и второй тип, используется CSS свойство, которое потом в самом expression "сбрасывается", так, что expression при первом выполнении как бы "удаляет" сам себя:
<ol class="code">
<li>background-image:expression(</li>
<li class="tab">this.runtimeStyle.backgroundImage = 'none', </li>
<li class="tab">//а здесь пишем нужный нам код</li>
<li>);</li>
</ol>
<code>background-image</code> тут играет лишь роль флага, на самом деле скриптить таким способом можно все, что вам нужно, как-то так выглядит эмуляция :first-child:
<ol class="code">
<li>background-image:expression(</li>
<li class="tab">this.runtimeStyle.backgroundImage = 'none', </li>
<li class="tab">this.previousSibling?false:this.className += 'first-child'</li>
<li>);</li>
</ol>
Когда мы присваиваем свойству <code>none</code>, соответственно и expression перестает исполняться.

Безопасно вместо <code>background-image</code> использовать всякие редкие свойства вроде <code>azimuth</code>.

<h3>Изучать дальше</h3>
Вообще за поднятую тему оптимизации expression спасибо <a href="http://lusever.ru/">Павлу Корнилову</a> выступившему с соответствующим докладом на ClientSide 2007.

Следует помнить, что одноразовые expression нельзя применять для min-width, min-height и прочего. По понятным причинам  подсчеты произведутся только при загрузке страницы.
<ul>
<li><a href="http://cssing.org.ua/examples/expression/">Пример трех одноразовых expression</a> а так же <a href="http://cssing.org.ua/examples/expression/bad.html">пример одного обычного</a></li>
<li><a href="http://lusever.ru/proceedings/thin_css/index.html">Текст доклада Корнилова на ClientSide</a> и <a href="http://lusever.livejournal.com/15868.html">жж-пост про это</a>, рекомендую ознакомиться с презентацией(внизу текста на его сайте есть линк)</li>
<li><a href="http://komodomedia.com/blog/index.php/2007/11/05/css-png-image-fix-for-ie/">PNG fix</a> использующий прием оптимизации, в комментариях есть несколько способов оптимизации</li>
<li><a href="http://harisov.livejournal.com/58661.html">PNG прозрачность у Харисова</a> с использованием "одноразовости"</li>
</ul>
